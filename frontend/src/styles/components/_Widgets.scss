@use '../helpers' as h;

// Base widget styles
.tools-grid {
	padding: var(--spacing-xl) var(--spacing-lg);
	overflow-y: auto;
	
	// Скрываем scrollbar
	scrollbar-width: none;
	-ms-overflow-style: none;
	&::-webkit-scrollbar {
		display: none;
	}
	
	&__container {
		max-width: h.rem(1200);
		margin: 0 auto;
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(h.rem(320), 1fr));
		gap: var(--spacing-lg);
		
		@include h.mobile {
			grid-template-columns: 1fr;
		}
	}
	
	&__widget {
		position: relative;
		
		&--pinned {
			.widget::before {
				opacity: 1;
			}
		}
	}
}

.widget {
	background-color: var(--color-white);
	border-radius: var(--border-radius);
	border: var(--border);
	overflow: hidden;
	display: flex;
	flex-direction: column;
	transition: all var(--transition-duration) var(--transition-easing);
	position: relative;
	
	// Индикатор закрепленного виджета
	&::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		height: h.rem(3);
		background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-primary-hover) 100%);
		opacity: 0;
		transition: opacity var(--transition-duration) var(--transition-easing);
		z-index: 1;
	}
	
	@include h.hover(false) {
		box-shadow: 0 h.rem(4) h.rem(12) rgba(0, 0, 0, 0.08);
	}
	
	&__header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding: var(--spacing-md) var(--spacing-lg);
		border-bottom: var(--border);
		background-color: var(--color-bg-secondary);
	}
	
	&__title {
		display: flex;
		align-items: center;
		gap: var(--spacing-sm);
		margin: 0;
		font-family: var(--font-family-secondary), sans-serif;
		font-size: h.rem(16);
		font-weight: 600;
		color: var(--color-text-primary);
		
		svg {
			flex-shrink: 0;
			color: var(--color-primary);
		}
	}
	
	&__actions {
		display: flex;
		align-items: center;
		gap: var(--spacing-sm);
	}
	
	&__pin {
		display: flex;
		align-items: center;
		justify-content: center;
		width: h.rem(28);
		height: h.rem(28);
		background: none;
		border: none;
		border-radius: var(--border-radius);
		color: var(--color-text-muted);
		cursor: pointer;
		transition: all var(--transition-duration) var(--transition-easing);
		
		@include h.hover(false) {
			background-color: var(--color-bg-hover);
			color: var(--color-primary);
			transform: scale(1.1);
		}
		
		&:active {
			transform: scale(0.95);
		}
		
		&--active {
			color: var(--color-primary);
			background-color: var(--color-primary-light);
		}
	}
	
	&__close {
		display: flex;
		align-items: center;
		justify-content: center;
		width: h.rem(28);
		height: h.rem(28);
		background: none;
		border: none;
		border-radius: var(--border-radius);
		color: var(--color-text-muted);
		cursor: pointer;
		transition: all var(--transition-duration) var(--transition-easing);
		
		@include h.hover(false) {
			background-color: var(--color-bg-hover);
			color: var(--color-text-primary);
		}
	}
	
	&__content {
		padding: var(--spacing-lg);
		flex: 1;
		display: flex;
		flex-direction: column;
		gap: var(--spacing-md);
	}
}

// Stats Widget
.stats-widget {
	&__grid {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		gap: var(--spacing-md);
	}
	
	&__item {
		display: flex;
		align-items: center;
		gap: var(--spacing-md);
		padding: var(--spacing-md);
		background-color: var(--color-bg-secondary);
		border-radius: var(--border-radius);
		transition: all var(--transition-duration) var(--transition-easing);
		
		@include h.hover(false) {
			transform: scale(1.03);
		}
		
		&--blue .stats-widget__icon {
			background-color: #dbeafe;
			color: #2563eb;
		}
		
		&--green .stats-widget__icon {
			background-color: #dcfce7;
			color: #16a34a;
		}
		
		&--purple .stats-widget__icon {
			background-color: #f3e8ff;
			color: #9333ea;
		}
		
		&--orange .stats-widget__icon {
			background-color: #fed7aa;
			color: #ea580c;
		}
	}
	
	&__icon {
		width: h.rem(48);
		height: h.rem(48);
		display: flex;
		align-items: center;
		justify-content: center;
		border-radius: var(--border-radius);
		flex-shrink: 0;
	}
	
	&__info {
		flex: 1;
		min-width: 0;
	}
	
	&__value {
		font-family: var(--font-family-secondary), sans-serif;
		font-size: h.rem(24);
		font-weight: 700;
		color: var(--color-text-primary);
		line-height: 1;
	}
	
	&__label {
		font-size: h.rem(12);
		color: var(--color-text-muted);
		margin-top: h.rem(4);
	}
}

// Timer Widget (Pomodoro + Countdown)
.pomodoro-widget,
.countdown-widget {
	&__modes {
		display: flex;
		gap: var(--spacing-xs);
		padding: var(--spacing-xs);
		background-color: var(--color-bg-secondary);
		border-radius: var(--border-radius);
	}
	
	&__mode {
		flex: 1;
		padding: var(--spacing-sm);
		background: none;
		border: none;
		border-radius: var(--border-radius);
		font-size: h.rem(14);
		font-weight: 500;
		color: var(--color-text-secondary);
		cursor: pointer;
		transition: all var(--transition-duration) var(--transition-easing);
		
		@include h.hover(false) {
			background-color: var(--color-white);
			color: var(--color-text-primary);
		}
		
		&--active {
			background-color: var(--color-primary);
			color: var(--color-white);
		}
	}
	
	&__timer {
		display: flex;
		align-items: center;
		justify-content: center;
		padding: var(--spacing-xl) 0;
	}
	
	&__circle {
		position: relative;
		width: h.rem(180);
		height: h.rem(180);
		display: flex;
		align-items: center;
		justify-content: center;
		border-radius: 50%;
		background: conic-gradient(
				var(--color-primary) calc(var(--progress) * 1%),
				var(--color-bg-secondary) 0
		);
		
		&::before {
			content: '';
			position: absolute;
			inset: h.rem(8);
			background-color: var(--color-white);
			border-radius: 50%;
		}
	}
	
	&__time {
		position: relative;
		z-index: 1;
		font-family: var(--font-family-secondary), sans-serif;
		font-size: h.rem(36);
		font-weight: 700;
		color: var(--color-text-primary);
	}
	
	&__controls {
		display: flex;
		gap: var(--spacing-sm);
	}
}

.countdown-widget {
	&__display {
		display: flex;
		align-items: center;
		justify-content: center;
		padding: var(--spacing-xl);
	}
	
	&__time {
		font-family: var(--font-family-secondary), sans-serif;
		font-size: h.rem(48);
		font-weight: 700;
		color: var(--color-primary);
	}
	
	&__edit {
		padding: var(--spacing-md) 0;
	}
}

// Poll Widget
.poll-widget {
	&__question {
		font-family: var(--font-family-secondary), sans-serif;
		font-size: h.rem(16);
		font-weight: 600;
		color: var(--color-text-primary);
		margin-bottom: var(--spacing-xs);
	}
	
	&__meta {
		font-size: h.rem(12);
		color: var(--color-text-muted);
		margin-bottom: var(--spacing-md);
	}
	
	&__results {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-sm);
		margin-bottom: var(--spacing-md);
	}
	
	&__option {
		position: relative;
		width: 100%;
		padding: var(--spacing-md);
		background-color: var(--color-bg-secondary);
		border: h.rem(2) solid transparent;
		border-radius: var(--border-radius);
		cursor: pointer;
		transition: all var(--transition-duration) var(--transition-easing);
		overflow: hidden;
		
		@include h.hover(false) {
			border-color: var(--color-primary);
		}
		
		&--voted {
			border-color: var(--color-primary);
			background-color: var(--color-primary-light);
		}
		
		&--disabled {
			cursor: not-allowed;
		}
	}
	
	&__option-bar {
		position: absolute;
		top: 0;
		left: 0;
		height: 100%;
		background: linear-gradient(90deg, var(--color-primary-light) 0%, transparent 100%);
		transition: width 0.3s ease;
	}
	
	&__option-content {
		position: relative;
		display: flex;
		justify-content: space-between;
		align-items: center;
	}
	
	&__option-text {
		font-size: h.rem(14);
		font-weight: 500;
		color: var(--color-text-primary);
	}
	
	&__option-percentage {
		font-size: h.rem(14);
		font-weight: 600;
		color: var(--color-primary);
	}
	
	&__empty {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		padding: var(--spacing-xl);
		text-align: center;
		
		svg {
			color: var(--color-text-muted);
			margin-bottom: var(--spacing-md);
		}
		
		p {
			margin: 0 0 var(--spacing-md) 0;
			font-size: h.rem(14);
			color: var(--color-text-muted);
		}
	}
	
	&__options {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-sm);
	}
	
	&__option-input {
		display: flex;
		gap: var(--spacing-sm);
		align-items: flex-end;
		
		.input-wrapper {
			flex: 1;
		}
	}
	
	&__remove-option {
		width: h.rem(40);
		height: h.rem(40);
		display: flex;
		align-items: center;
		justify-content: center;
		background: none;
		border: none;
		border-radius: var(--border-radius);
		color: var(--color-danger);
		cursor: pointer;
		transition: all var(--transition-duration) var(--transition-easing);
		flex-shrink: 0;
		
		@include h.hover(false) {
			background-color: var(--color-danger-light);
		}
	}
	
	&__actions {
		display: flex;
		gap: var(--spacing-sm);
		justify-content: flex-end;
		padding-top: var(--spacing-md);
		border-top: var(--border);
	}
}

// Create Poll Widget
.create-poll-widget {
	&__options {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-sm);
	}
	
	&__option-input {
		display: flex;
		gap: var(--spacing-sm);
		align-items: flex-end;
		
		.input-wrapper {
			flex: 1;
		}
	}
	
	&__remove-option {
		width: h.rem(40);
		height: h.rem(40);
		display: flex;
		align-items: center;
		justify-content: center;
		background: none;
		border: none;
		border-radius: var(--border-radius);
		color: var(--color-danger);
		cursor: pointer;
		transition: all var(--transition-duration) var(--transition-easing);
		flex-shrink: 0;
		
		@include h.hover(false) {
			background-color: var(--color-danger-light);
		}
	}
}

// Todo Widget
.todo-widget {
	&__count {
		font-size: h.rem(12);
		font-weight: 600;
		color: var(--color-text-muted);
		background-color: var(--color-white);
		padding: h.rem(4) var(--spacing-sm);
		border-radius: h.rem(12);
		border: var(--border);
	}
	
	&__input {
		display: flex;
		gap: var(--spacing-sm);
	}
	
	&__new-input {
		flex: 1;
		padding: var(--spacing-sm) var(--spacing-md);
		font-family: var(--font-family-primary), sans-serif;
		font-size: h.rem(14);
		color: var(--color-text-primary);
		background-color: var(--color-bg-secondary);
		border: h.rem(2) solid transparent;
		border-radius: var(--border-radius);
		transition: all var(--transition-duration) var(--transition-easing);
		
		&::placeholder {
			color: var(--color-text-muted);
		}
		
		&:focus {
			outline: none;
			border-color: var(--color-primary);
			background-color: var(--color-white);
		}
	}
	
	&__add-button {
		width: h.rem(40);
		height: h.rem(40);
		display: flex;
		align-items: center;
		justify-content: center;
		background-color: var(--color-primary);
		border: none;
		border-radius: var(--border-radius);
		color: var(--color-white);
		cursor: pointer;
		transition: all var(--transition-duration) var(--transition-easing);
		flex-shrink: 0;
		
		@include h.hover(false) {
			background-color: var(--color-primary-hover);
			transform: scale(1.05);
		}
		
		&:active {
			transform: scale(0.95);
		}
		
		&:disabled {
			opacity: 0.5;
			cursor: not-allowed;
			transform: none;
		}
	}
	
	&__list {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-xs);
		max-height: h.rem(300);
		overflow-y: auto;
		
		// Скрываем scrollbar
		scrollbar-width: none;
		-ms-overflow-style: none;
		&::-webkit-scrollbar {
			display: none;
		}
	}
	
	&__item {
		display: flex;
		align-items: flex-start;
		gap: var(--spacing-sm);
		padding: var(--spacing-sm);
		background-color: var(--color-bg-secondary);
		border-radius: var(--border-radius);
		transition: all var(--transition-duration) var(--transition-easing);
		
		@include h.hover(false) {
			background-color: var(--color-bg-hover);
		}
		
		&--completed {
			opacity: 0.6;
			
			.todo-widget__text {
				text-decoration: line-through;
			}
		}
	}
	
	&__checkbox {
		display: flex;
		align-items: center;
		cursor: pointer;
		flex-shrink: 0;
		padding-top: h.rem(2);
		
		input {
			display: none;
		}
	}
	
	&__checkmark {
		width: h.rem(20);
		height: h.rem(20);
		display: flex;
		align-items: center;
		justify-content: center;
		border: h.rem(2) solid var(--color-border);
		border-radius: h.rem(4);
		background-color: var(--color-white);
		transition: all var(--transition-duration) var(--transition-easing);
		
		input:checked + & {
			background-color: var(--color-primary);
			border-color: var(--color-primary);
			
			svg {
				stroke: var(--color-white);
			}
		}
	}
	
	&__content {
		flex: 1;
		display: flex;
		flex-direction: column;
		gap: h.rem(4);
		min-width: 0;
	}
	
	&__text {
		font-size: h.rem(14);
		color: var(--color-text-primary);
		word-wrap: break-word;
		line-height: 1.4;
	}
	
	&__completed-by {
		font-size: h.rem(11);
		color: var(--color-text-muted);
		font-style: italic;
	}
	
	&__delete {
		width: h.rem(28);
		height: h.rem(28);
		display: flex;
		align-items: center;
		justify-content: center;
		background: none;
		border: none;
		border-radius: var(--border-radius);
		color: var(--color-text-muted);
		cursor: pointer;
		opacity: 0;
		transition: all var(--transition-duration) var(--transition-easing);
		flex-shrink: 0;
		
		.todo-widget__item:hover & {
			opacity: 1;
		}
		
		@include h.hover(false) {
			background-color: var(--color-danger-light);
			color: var(--color-danger);
		}
	}
	
	&__empty {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		padding: var(--spacing-xl);
		text-align: center;
		
		svg {
			color: var(--color-text-muted);
			margin-bottom: var(--spacing-md);
		}
		
		p {
			margin: 0;
			font-size: h.rem(14);
			color: var(--color-text-muted);
		}
	}
}